app.controller('SecurityController', function($scope, $http, $location) {

	$scope.pageLoad = function (){
		loadGarageDoor();		
		loadImage();
	}
	
	function loadImage(){
		$http({
			method  : 'GET',
			url     : "rest/jsonservices/read/image-DoorLock",
			headers : { 'Content-Type': 'application/xml'}  
		}).success(function (data) {
			$scope.storeImage = data;
			getStatus();
		})
		.error(function(data) {	
			$scope.doorStatus = "OPEN Error!!!"
				console.log('error');
		});
	}
	
	function loadGarageDoor(){
		$http({
			method  : 'GET',
			url     : "rest/jsonservices/read/Status-DoorLock",
			headers : { 'Content-Type': 'application/xml'}  
		}).success(function (data) {
			$scope.storeStatus = data;
			getStatus();
		})
		.error(function(data) {	
			$scope.doorStatus = "OPEN Error!!!"
				console.log('error');
		});
	}	
	
	
	// code to close the door
	$scope.closeDoor = function(){
	$scope.storeStatus ="CLOSED";
	$scope.storeImage ="_images/door4.jpg";
	clse();
//	clseImage();
	
	function clse(){
		 $http({
			 method  : 'POST',
			 url     : "rest/jsonservices/write",
			 data    : $.param({
				 	deviceType : "ClientDoorLock", 
					attribute : "Status",
					newValue : "CLOSED"
			 }),  
			 headers : { 'Content-Type': 'application/x-www-form-urlencoded' }  
			}).success(function (data) {
				clseImage();
//				getStatus();
//				$scope.products[2].cover = '_images/door4.jpg';  // changes to different door
			})
			.error(function(data) {
			console.log('error');
			});	
	}
	
	function clseImage(){
		console.log("inside write image function")
		 $http({
			 method  : 'POST',
			 url     : "rest/jsonservices/write",
			 data    : $.param({
				 	deviceType : "ClientDoorLock", 
					attribute : "image",
					newValue : "_images/door4.jpg"
			 }),  
			 headers : { 'Content-Type': 'application/x-www-form-urlencoded' }  
			}).success(function (data) {
				getStatus();
				postMessage();
//				$scope.products[2].cover = '_images/door4.jpg';  // changes to different image
			})
			.error(function(data) {
			console.log('error');
			});	
	}
}	
	
	function postMessage(){
		
		
	}
	
	
	function getStatus(){
		$scope.products = [ 
{ 	
	name: 'Front Door', 
	cover: '_images/door1.jpg',
	camera: 'Camera001',
	status: 'CLOSED'	
},
{ 
	name: 'Back Door', 
	cover: '_images/door2.jpg',
	camera: 'Camera002',
	status: 'CLOSED'

},
{
	name: 'Garage Door', 
	cover: $scope.storeImage,
	camera: 'Camera003',
	status: $scope.storeStatus	
}
]
		
	}

	

})
